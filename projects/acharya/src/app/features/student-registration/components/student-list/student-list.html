<div class="container py-5">
  <!-- Header -->
  <div class="row align-items-center mb-4">
    <div class="col-md-6">
      <div class="d-flex align-items-center mb-2">
        <a routerLink="/home" class="btn btn-outline-primary btn-sm me-3">
          <i class="bi bi-house me-1"></i>
          Home
        </a>
        <h1 class="display-5 fw-bold text-primary mb-0">Students</h1>
      </div>
      <p class="lead text-muted mb-0">
        {{ studentsCount() }} student{{ studentsCount() !== 1 ? 's' : '' }} registered
      </p>
    </div>
    <div class="col-md-6 text-md-end">
      <button 
        class="btn btn-primary btn-lg px-4"
        (click)="addNewStudent()">
        <i class="bi bi-plus-circle me-2"></i>
        Add New Student
      </button>
    </div>
  </div>

  <!-- Search and Filters -->
  <div class="card shadow-sm border-0 mb-4">
    <div class="card-body p-4">
      <div class="row g-3">
        <div class="col-md-6">
          <label for="searchInput" class="form-label">Search Students</label>
          <div class="input-group">
            <span class="input-group-text">
              <i class="bi bi-search"></i>
            </span>
            <input 
              type="text" 
              id="searchInput"
              class="form-control" 
              placeholder="Search by name, email, or school..."
              [value]="searchQuery()"
              (input)="onSearchChange(($any($event.target).value))">
          </div>
        </div>
        
        <div class="col-md-4">
          <label for="gradeFilter" class="form-label">Filter by Grade</label>
          <select 
            id="gradeFilter"
            class="form-select" 
            [value]="selectedGrade()"
            (change)="onGradeFilterChange($any($event.target).value)">
            <option value="">All Grades</option>
            <option *ngFor="let grade of gradeOptions" [value]="grade">
              {{ grade }}
            </option>
          </select>
        </div>
        
        <div class="col-md-2 d-flex align-items-end">
          <button 
            class="btn btn-outline-secondary w-100"
            (click)="clearFilters()"
            [disabled]="!searchQuery() && !selectedGrade()">
            Clear
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading()" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-3 text-muted">Loading students...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error() && !loading()" class="alert alert-danger" role="alert">
    <h5 class="alert-heading">Error Loading Students</h5>
    <p class="mb-0">{{ error() }}</p>
    <button 
      class="btn btn-outline-danger mt-2"
      (click)="loadStudents()">
      Try Again
    </button>
  </div>

  <!-- Empty State -->
  <div *ngIf="!loading() && !error() && !hasStudents()" class="text-center py-5">
    <div class="mb-4">
      <i class="bi bi-people display-1 text-muted"></i>
    </div>
    <h3 class="text-muted mb-3">No Students Found</h3>
    <p class="text-muted mb-4">Get started by registering your first student.</p>
    <button 
      class="btn btn-primary btn-lg px-4"
      (click)="addNewStudent()">
      Register First Student
    </button>
  </div>

  <!-- Students Grid -->
  <div *ngIf="!loading() && !error() && hasStudents()" class="row g-4">
    <div 
      *ngFor="let student of filteredStudents()" 
      class="col-lg-4 col-md-6">
      
      <div class="card h-100 shadow-sm border-0 student-card">
        <div class="card-body p-4">
          <!-- Student Header -->
          <div class="d-flex justify-content-between align-items-start mb-3">
            <div>
              <h5 class="card-title mb-1 fw-bold">{{ student.fullName }}</h5>
              <span 
                class="badge bg-{{ getGradeColor(student.grade) }} rounded-pill">
                {{ student.grade }}
              </span>
            </div>
            <div class="dropdown">
              <button 
                class="btn btn-link btn-sm text-muted p-0"
                type="button"
                data-bs-toggle="dropdown"
                aria-expanded="false">
                <i class="bi bi-three-dots-vertical"></i>
              </button>
              <ul class="dropdown-menu">
                <li>
                  <button 
                    class="dropdown-item"
                    (click)="viewStudent(student)">
                    <i class="bi bi-eye me-2"></i>View Details
                  </button>
                </li>
                <li>
                  <button 
                    class="dropdown-item"
                    (click)="editStudent(student)">
                    <i class="bi bi-pencil me-2"></i>Edit
                  </button>
                </li>
                <li><hr class="dropdown-divider"></li>
                <li>
                  <button 
                    class="dropdown-item text-danger"
                    (click)="deleteStudent(student)">
                    <i class="bi bi-trash me-2"></i>Delete
                  </button>
                </li>
              </ul>
            </div>
          </div>

          <!-- Student Info -->
          <div class="mb-3">
            <div class="row g-2">
              <div class="col-12">
                <small class="text-muted d-block">
                  <i class="bi bi-envelope me-1"></i>
                  {{ student.email }}
                </small>
              </div>
              <div class="col-12">
                <small class="text-muted d-block">
                  <i class="bi bi-telephone me-1"></i>
                  {{ student.phoneNumber }}
                </small>
              </div>
              <div class="col-12">
                <small class="text-muted d-block">
                  <i class="bi bi-building me-1"></i>
                  {{ student.schoolName }}
                </small>
              </div>
              <div class="col-12">
                <small class="text-muted d-block">
                  <i class="bi bi-geo-alt me-1"></i>
                  {{ student.city }}, {{ student.state }}
                </small>
              </div>
            </div>
          </div>

          <!-- Age and Registration Date -->
          <div class="d-flex justify-content-between align-items-center">
            <small class="text-muted">
              Age: {{ student.age }}
            </small>
            <small class="text-muted">
              Registered: {{ student.createdAt | date:'shortDate' }}
            </small>
          </div>
        </div>

        <!-- Card Footer -->
        <div class="card-footer bg-transparent border-0 pt-0">
          <div class="d-grid">
            <button 
              class="btn btn-outline-primary btn-sm"
              (click)="viewStudent(student)">
              View Full Profile
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- No Results Message -->
  <div *ngIf="!loading() && !error() && hasStudents() && filteredStudents().length === 0" 
       class="text-center py-5">
    <div class="mb-4">
      <i class="bi bi-search display-1 text-muted"></i>
    </div>
    <h3 class="text-muted mb-3">No Students Found</h3>
    <p class="text-muted mb-4">
      No students match your current search criteria.
    </p>
    <button 
      class="btn btn-outline-primary"
      (click)="clearFilters()">
      Clear Filters
    </button>
  </div>
</div>
